# TLS Certificate Monitor Configuration - Linux
# Generated by Ansible

# Server settings
port: {{ tls_cert_monitor_config.port | default(3200) }}
bind_address: "{{ tls_cert_monitor_config.bind_address | default('0.0.0.0') }}"

# TLS settings for metrics endpoint (optional)
{% if enable_tls %}
tls_cert: "{{ tls_cert_dir_linux }}/{{ tls_cert_filename }}"
tls_key: "{{ tls_cert_dir_linux }}/{{ tls_key_filename }}"
{% else %}
# tls_cert: "/path/to/server.crt"
# tls_key: "/path/to/server.key"
{% endif %}

# Certificate monitoring
certificate_directories:
{% if tls_cert_monitor_config.certificate_directories is defined %}
{% for dir in tls_cert_monitor_config.certificate_directories %}
  - "{{ dir }}"
{% endfor %}
{% else %}
{% for dir in cert_dirs_linux | default(['/etc/ssl/certs', '/etc/pki/tls/certs']) %}
  - "{{ dir }}"
{% endfor %}
{% endif %}

# Directories to exclude from scanning (optional)
exclude_directories:
{% if tls_cert_monitor_config.exclude_directories is defined %}
{% for dir in tls_cert_monitor_config.exclude_directories %}
  - "{{ dir }}"
{% endfor %}
{% else %}
  - "/etc/ssl/certs/private"
  - "/etc/ssl/certs/backup"
  - "/etc/pki/tls/certs/archived"
{% endif %}

# File patterns to exclude from scanning (optional)
exclude_file_patterns:
{% if tls_cert_monitor_config.exclude_file_patterns is defined %}
{% for pattern in tls_cert_monitor_config.exclude_file_patterns %}
  - "{{ pattern }}"
{% endfor %}
{% else %}
  - "dhparam.pem"        # Exclude Diffie-Hellman parameter files
  - ".*\\\\.key$"        # Exclude private key files (must escape backslashes)
  - ".*backup.*"         # Exclude backup files
{% endif %}

# P12/PFX certificate passwords
p12_passwords:
{% if tls_cert_monitor_config.p12_passwords is defined %}
{% for password in tls_cert_monitor_config.p12_passwords %}
  - "{{ password }}"
{% endfor %}
{% else %}
  - ""                    # Empty password (no password)
  - "changeit"            # Java keystore default
  - "password"            # Common default
  - "123456"              # Common weak password
{% endif %}

# Scan interval (how often to scan for certificates)
scan_interval: "{{ tls_cert_monitor_config.scan_interval | default('5m') }}"

# Performance settings
workers: {{ tls_cert_monitor_config.workers | default(4) }}

# Logging
log_level: "{{ tls_cert_monitor_config.log_level | default('INFO') }}"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
{% if tls_cert_monitor_config.log_file is defined %}
log_file: "{{ tls_cert_monitor_config.log_file }}"
{% else %}
log_file: "{{ log_dir_linux }}/tls-monitor.log"
{% endif %}

# Operation modes
dry_run: {{ tls_cert_monitor_config.dry_run | default(false) | lower }}
hot_reload: {{ tls_cert_monitor_config.hot_reload | default(true) | lower }}

# Cache settings
cache_type: "{{ tls_cert_monitor_config.cache_type | default('memory') }}"       # "memory", "file", or "both"
cache_dir: "{{ tls_cert_monitor_config.cache_dir | default('/var/cache/tls-cert-monitor') }}"
cache_ttl: "{{ tls_cert_monitor_config.cache_ttl | default('1h') }}"
cache_max_size: {{ tls_cert_monitor_config.cache_max_size | default(10485760) }}   # 10MB (memory)

# Security settings
enable_ip_whitelist: {{ tls_cert_monitor_config.enable_ip_whitelist | default(enable_ip_whitelist) | default(true) | lower }}
allowed_ips:
{% if tls_cert_monitor_config.allowed_ips is defined %}
{% for ip in tls_cert_monitor_config.allowed_ips %}
  - "{{ ip }}"
{% endfor %}
{% endif %}