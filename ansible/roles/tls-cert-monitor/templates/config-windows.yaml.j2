# TLS Certificate Monitor Configuration - Windows
# Generated by Ansible
# This configuration file is tailored for Windows environments

# Server settings
port: {{ tls_cert_monitor_config.port | default(3200) }}
bind_address: "{{ tls_cert_monitor_config.bind_address | default('0.0.0.0') }}"

# TLS settings for metrics endpoint (optional)
{% if enable_tls %}
tls_cert: "{{ tls_cert_dir_windows }}\\{{ tls_cert_filename }}"
tls_key: "{{ tls_cert_dir_windows }}\\{{ tls_key_filename }}"
{% else %}
# tls_cert: "C:\\certs\\server.crt"
# tls_key: "C:\\certs\\server.key"
{% endif %}

# Certificate monitoring - Windows common certificate locations
certificate_directories:
{% if tls_cert_monitor_config.certificate_directories is defined %}
{% for dir in tls_cert_monitor_config.certificate_directories %}
  - "{{ dir }}"
{% endfor %}
{% else %}
{% for dir in cert_dirs_windows | default(['C:\\ProgramData\\ssl\\certs', 'C:\\certificates', 'C:\\inetpub\\certs']) %}
  - "{{ dir }}"
{% endfor %}
{% endif %}

# Directories to exclude from scanning (optional)
exclude_directories:
{% if tls_cert_monitor_config.exclude_directories is defined %}
{% for dir in tls_cert_monitor_config.exclude_directories %}
  - "{{ dir }}"
{% endfor %}
{% else %}
  - "C:\\Windows\\System32\\config\\systemprofile\\AppData\\Roaming\\Microsoft\\SystemCertificates\\Disallowed"
  - "C:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys\\archived"
  - "C:\\certs\\backup"
  - "C:\\certificates\\old"
{% endif %}

# File patterns to exclude from scanning (optional)
exclude_file_patterns:
{% if tls_cert_monitor_config.exclude_file_patterns is defined %}
{% for pattern in tls_cert_monitor_config.exclude_file_patterns %}
  - "{{ pattern }}"
{% endfor %}
{% else %}
  - "dhparam.pem"        # Exclude Diffie-Hellman parameter files
  - ".*\\.key$"          # Exclude private key files
  - ".*backup.*"         # Exclude backup files
  - ".*\\.bak$"          # Exclude Windows .bak files
  - ".*temp.*"           # Exclude temporary files
{% endif %}

# P12/PFX certificate passwords
p12_passwords:
{% if tls_cert_monitor_config.p12_passwords is defined %}
{% for password in tls_cert_monitor_config.p12_passwords %}
  - "{{ password }}"
{% endfor %}
{% else %}
  - ""                    # Empty password (no password)
  - "changeit"            # Java keystore default
  - "password"            # Common default
  - "123456"              # Common weak password
  - "admin"               # Common Windows admin password
  - "Password1"           # Common Windows complexity password
  - "P@ssw0rd"            # Common Windows complexity password
  - "certificate"         # Self-descriptive password
{% endif %}

# Scan interval (how often to scan for certificates)
scan_interval: "{{ tls_cert_monitor_config.scan_interval | default('5m') }}"

# Performance settings
# Adjust based on your Windows server specifications
workers: {{ tls_cert_monitor_config.workers | default(2) }}

# Logging
log_level: "{{ tls_cert_monitor_config.log_level | default('INFO') }}"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
{% if tls_cert_monitor_config.log_file is defined %}
log_file: "{{ tls_cert_monitor_config.log_file }}"
{% else %}
log_file: "{{ log_dir_windows }}\\tls-monitor.log"
{% endif %}

# Operation modes
dry_run: {{ tls_cert_monitor_config.dry_run | default(false) | lower }}
hot_reload: {{ tls_cert_monitor_config.hot_reload | default(true) | lower }}

# Cache settings - Windows paths
cache_type: "{{ tls_cert_monitor_config.cache_type | default('memory') }}"       # "memory", "file", or "both"
cache_dir: "{{ tls_cert_monitor_config.cache_dir | default('C:\\ProgramData\\TLSCertMonitor\\cache') }}"
cache_ttl: "{{ tls_cert_monitor_config.cache_ttl | default('1h') }}"
cache_max_size: {{ tls_cert_monitor_config.cache_max_size | default(10485760) }}   # 10MB (memory)

# Security settings
enable_ip_whitelist: {{ tls_cert_monitor_config.enable_ip_whitelist | default(true) | lower }}
allowed_ips:
{% if tls_cert_monitor_config.allowed_ips is defined %}
{% for ip in tls_cert_monitor_config.allowed_ips %}
  - "{{ ip }}"
{% endfor %}
{% else %}
  - "127.0.0.1"           # Localhost IPv4
  - "::1"                 # Localhost IPv6
  - "192.168.1.0/24"      # Local network (CIDR notation)
{% endif %}