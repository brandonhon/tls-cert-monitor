# TLS Certificate Monitor Configuration - Windows Example
# This configuration file is tailored for Windows environments

# Server settings
port: 3200
bind_address: "0.0.0.0"

# TLS settings for metrics endpoint (optional)
# tls_cert: "C:\\certs\\server.crt"
# tls_key: "C:\\certs\\server.key"

# Certificate monitoring - Windows common certificate locations
certificate_directories:
  # Windows Certificate Store locations (if certificates are exported to files)
  - "C:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys"
  - "C:\\Windows\\System32\\config\\systemprofile\\AppData\\Roaming\\Microsoft\\SystemCertificates"
  
  # IIS certificate locations
  - "C:\\inetpub\\certs"
  - "C:\\Windows\\System32\\inetsrv\\config\\certs"
  
  # Common application certificate directories
  - "C:\\Program Files\\Common Files\\SSL"
  - "C:\\certs"
  - "C:\\certificates"
  - "C:\\ssl"
  
  # Exchange Server certificates (if applicable)
  - "C:\\Program Files\\Microsoft\\Exchange Server\\V15\\Bin"
  
  # Apache/Nginx on Windows
  - "C:\\Apache24\\conf\\ssl"
  - "C:\\nginx\\conf\\ssl"
  
  # Java application certificates
  - "C:\\Program Files\\Java\\jre*\\lib\\security"
  - "C:\\Program Files (x86)\\Java\\jre*\\lib\\security"
  
  # Custom application directories (add your specific paths)
  # - "C:\\MyApp\\certificates"
  # - "D:\\ssl-certs"

# Directories to exclude from scanning (optional)
# These paths will be skipped even if they are within certificate_directories
exclude_directories:
  - "C:\\Windows\\System32\\config\\systemprofile\\AppData\\Roaming\\Microsoft\\SystemCertificates\\Disallowed"
  - "C:\\ProgramData\\Microsoft\\Crypto\\RSA\\MachineKeys\\archived"
  - "C:\\certs\\backup"
  - "C:\\certificates\\old"
  # Add directories you want to exclude from certificate scanning

# File patterns to exclude from scanning (optional)
# These are regex patterns that will exclude files by name
exclude_file_patterns:
  - "dhparam.pem"        # Exclude Diffie-Hellman parameter files
  - ".*\\.key$"         # Exclude private key files  
  - ".*backup.*"        # Exclude backup files
  - ".*\\.bak$"         # Exclude Windows .bak files
  - ".*temp.*"          # Exclude temporary files
  # Add regex patterns for files you want to exclude

# P12/PFX certificate passwords
# List of passwords to try when decrypting P12/PFX certificate files
# Windows environments often use these common passwords
p12_passwords:
  - ""                    # Empty password (no password)
  - "changeit"           # Java keystore default
  - "password"           # Common default
  - "123456"             # Common weak password
  - "admin"              # Common Windows admin password
  - "Password1"          # Common Windows complexity password
  - "P@ssw0rd"           # Common Windows complexity password
  - "certificate"        # Self-descriptive password
  # Add your organization-specific P12 passwords here
  # - "YourCompanyP12Password"
  # - "ExchangeServerCert"
  # - "IISCertPassword"

# Scan interval (how often to scan for certificates)
scan_interval: "5m"

# Performance settings
# Adjust based on your Windows server specifications
workers: 4

# Logging
log_level: "INFO"  # DEBUG, INFO, WARNING, ERROR, CRITICAL
# Windows-style log file path (optional)
# log_file: "C:\\logs\\tls-monitor.log"  # If not set, logs to stdout
# Alternative locations:
# log_file: "C:\\ProgramData\\tls-cert-monitor\\logs\\tls-monitor.log"
# log_file: "%APPDATA%\\tls-cert-monitor\\logs\\tls-monitor.log"

# Operation modes
dry_run: false
hot_reload: true

# Cache settings - Windows paths
cache_type: "memory"       # "memory", "file", or "both"
cache_dir: ".\\cache"              # Only used when cache_type is "file" or "both"
# cache_dir: "C:\\ProgramData\\tls-cert-monitor\\cache"  # Absolute path option
# cache_dir: "%TEMP%\\tls-monitor-cache"               # Temp directory option
cache_ttl: "1h"
cache_max_size: 10485760   # 10MB (memory), use 31457280 for file cache (30MB)

# Security settings
enable_ip_whitelist: true  # Enable IP address whitelisting for API access
allowed_ips:
  - "127.0.0.1"           # Localhost IPv4
  - "::1"                 # Localhost IPv6
  - "192.168.1.0/24"      # Local network (CIDR notation)
  # Add your specific IP addresses or networks here:
  # - "10.0.0.0/8"        # Private network range
  # - "172.16.0.100"      # Specific server IP
  # - "203.0.113.0/24"    # Public network range

# Windows-specific notes:
# 
# 1. File Paths:
#    - Use forward slashes (/) or double backslashes (\\) in paths
#    - Avoid single backslashes as they are escape characters in YAML
#    - Environment variables like %APPDATA% or %TEMP% are supported
#
# 2. Windows Certificate Store:
#    - This tool scans file-based certificates, not the Windows Certificate Store directly
#    - Export certificates from Windows Certificate Store to files if needed:
#      - Open certmgr.msc or certlm.msc
#      - Export certificates as .cer, .crt, .pem, .p12, or .pfx files
#
# 3. Common Certificate Locations on Windows:
#    - IIS: Store certificates in C:\inetpub\certs or similar
#    - Exchange: Usually in Exchange installation directory
#    - Java apps: Often in %JAVA_HOME%\lib\security
#    - Custom apps: Check application documentation
#
# 4. Permissions:
#    - Ensure the service account has read access to certificate directories
#    - Some system certificate directories require administrator privileges
#
# 5. Service Installation:
#    - Consider running as a Windows Service using tools like NSSM or sc.exe
#    - Set appropriate service account with necessary permissions
#
# 6. File Exclusion Patterns:
#    - Use regex patterns to exclude specific files by name
#    - Windows-specific patterns like .*\\.bak$ for backup files
#    - Escape backslashes in regex patterns (use \\\\)
#
# 7. Cache Configuration:
#    - "memory" cache: Fast, volatile, 10MB limit recommended
#    - "file" cache: Persistent across restarts, 30MB limit recommended  
#    - "both" cache: Combines memory + file caching
#    - File cache uses Windows-compatible atomic file operations
#
# 8. Firewall:
#    - Ensure port 3200 (or your chosen port) is open in Windows Firewall
#    - Add firewall rule: netsh advfirewall firewall add rule name="TLS Cert Monitor" dir=in action=allow protocol=TCP localport=3200
#
# 9. Security Configuration:
#    - IP whitelisting is enabled by default for production security
#    - Add your monitoring system IPs to the allowed_ips list
#    - Use bind_address: "127.0.0.1" instead of "0.0.0.0" for localhost-only access
#    - Review certificate_directories to ensure no sensitive system paths are included
#    - The application automatically blocks access to sensitive Windows system directories